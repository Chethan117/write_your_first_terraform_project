PROC SQL;
CREATE TABLE sample AS
SELECT SOME_VARIABLES
FROM TABLE_A A
LEFT JOIN TABLE_C C
ON A.DEF_NAME = C.DEF_NAME
   AND A.EVTDT = C.STDT
   AND C.STDT BETWEEN TODAY() - 7 AND TODAY() - 1 AND WEEKDAY(C.STDT) NOT IN (6, 7) /* Exclude Saturdays and Sundays */
WHERE A.EVT IN ('MODIFY', 'IMPLEMENT')
  AND A.EVTDT BETWEEN TODAY() - 7 AND TODAY() - 1 AND WEEKDAY(A.EVTDT) NOT IN (6, 7) /* Exclude Saturdays and Sundays */
  AND (C.RPTDT IS NULL OR ABS(DATDIF(A.EVTDT, C.STDT, 'D')) <= 30)
ORDER BY A.EVTDT ASC;
QUIT;

PROC SQL;
CREATE TABLE abc AS
SELECT 4_VARIABLES
FROM sample;
QUIT;

PROC SQL;
INSERT INTO POST_IMPORTANT_MON_TAB
SELECT 4_VARIABLES
FROM abc;

CREATE TEMP TABLE A1_A2_VOL AS
SELECT SOME_VARIABLES
FROM POST_IMPORTANT_MON_TAB A
LEFT JOIN TABLE_XYZ B
ON B.AUTDT >= TODAY() - 7 AND B.AUTDT <= A.SNPDT AND B.AUTDT < TODAY() AND WEEKDAY(B.AUTDT) NOT IN (6, 7) /* Exclude Saturdays and Sundays */
WHERE A.RULE_DESC IN ('A1', 'A2')
GROUP BY 1, 2, 3, 4;
QUIT;
